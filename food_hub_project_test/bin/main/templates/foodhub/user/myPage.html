<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{foodhub/index/headerAndFooter.html}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì´í˜ì´ì§€</title>
    
    <!-- css ì—°ê²° -->
	<link href="/assets/css/myPage.css" rel="stylesheet">
    
    <script>
	    $().ready(function() {
	        initMembershipType();
	        initGender();
	        initBookmark();
	    });
	    
	    
		function initMembershipType() {
			// ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ íšŒì› ìœ í˜• ê°’ ì½ê¸°
			let membershipType = "[[${userDTO.membershipType}]]"// text()ë¡œ ê°€ì ¸ì˜¤ê¸°
			
			// íšŒì› ìœ í˜•ì— ë”°ë¼ ì°½ì—…ì¼ í‘œì‹œ ì—¬ë¶€ ê²°ì •
			if (membershipType == "COMMON") {
				$("#businessDate").hide();  // ì°½ì—…ì¼ ìˆ¨ê¹€
				$("#businessType").hide();
				$("#membershipType").text("ì¼ë°˜íšŒì›"); // mypageì—ì„œ COMMONì„ ì¼ë°˜íšŒì›ìœ¼ë¡œ ì¶œë ¥
			} 
			else if (membershipType =="ADMIN") {
				$("#businessDate").hide();  // ì°½ì—…ì¼ ìˆ¨ê¹€
				$("#businessType").hide();
				$("#membershipType").text("ê´€ë¦¬ìíšŒì›"); // mypageì—ì„œ COMMONì„ ì¼ë°˜íšŒì›ìœ¼ë¡œ ì¶œë ¥
			}
			else {
				$("#businessDate").show();  // ì°½ì—…ì¼ í‘œì‹œ
				$("#businessType").show();
				$("#membershipType").text("ì‚¬ì—…ìíšŒì›"); // mypageì—ì„œ BUSSIë¥¼ ì‚¬ì—…ìíšŒì›ìœ¼ë¡œ ì¶œë ¥
			}
		}
	    
		function initGender() {   
			let gender = $("#gender").text();
			if (gender == "M") {
				$("#gender").text("ë‚¨ì„±");
			}
			else if (gender == "F") {
				$("#gender").text("ì—¬ì„±");
			}
		}
	    
		// ë¶ë§ˆí¬
		function initBookmark() {
			$(".remove-bookmark").click(function() {
				const postId = $(this).data("post-id");
		
				$.ajax({
				   type: "POST",
				   url: "/foodhub/post/toggleBookmark",
				   contentType: "application/json",
				   data: JSON.stringify({ postId: postId }),
				   success: function(response) {
				       alert(response.message); // ì•Œë¦¼ ë©”ì‹œì§€ í‘œì‹œ
				
				       if (!response.isBookmarked) {
				           location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ë°˜ì˜
				       }
				   },
				   error: function(error) {
				       console.error("Error:", error);
				       alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
				   }
				});
			});
		}
    </script>
</head>
<body>
<div layout:fragment="content">

    <div class="mypage">
        <h1>ë§ˆì´ í˜ì´ì§€</h1>

        <div class="profile-photo">
		    <img th:src="@{/foodhub/user/thumbnails(fileName=${userDTO.profileUUID})}"
		         alt="í”„ë¡œí•„ ì‚¬ì§„">
		</div>

        <div class="profile-info">
		  <div class="profile-info">
            <p th:utext="|<strong>ì•„ì´ë””</strong> : ${userDTO.userId}|"><p>
            <p th:utext="|<strong>ë‹‰ë„¤ì„</strong> : ${userDTO.nickname}|"></p>
            <p th:utext="|<strong>Email</strong> : ${userDTO.email}|"></p>
            <p th:utext="|<strong>íœ´ëŒ€í° ë²ˆí˜¸</strong> : ${userDTO.tel}|"></p>
            <p><strong>ì„±ë³„</strong> : <span id="gender" th:text="${userDTO.gender}"></span></p>
            <p th:utext="|<strong>ìƒì¼</strong> : ${userDTO.birthday}|"></p>
            <p><strong>íšŒì›ìœ í˜•</strong> : <span id="membershipType" th:text="${userDTO.membershipType}"></span></p>
            <p id="businessDate" style="display:none;">
			    <strong>ì°½ì—…ì¼: </strong><span th:text="${userDTO.foundingAt}"></span>
			</p>
			 <p id="businessType" style="display:none;">
			    <strong>ì—…ì¢…: </strong><span th:text="${userDTO.businessType}"></span>
			</p>
            <p th:utext="|<strong>ê°€ì…ì¼ì</strong> : ${#dates.format(userDTO.joinAt, 'yyyy-MM-dd')}|"></p>
            <p><strong>ì´ ë°©ë¬¸ íšŸìˆ˜:</strong> <span th:text="${userVisitCnt}"></span>íšŒ</p>
          </div>
        </div>
        
        <!-- ì¼ë°˜ ìœ ì € ì „ìš© ì˜ì—­: ë¶ë§ˆí¬, ê²Œì‹œê¸€, ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
		<div th:if="${userDTO.membershipType != 'ADMIN'}">
		  
			<!-- ê²Œì‹œê¸€ ë¶ë§ˆí¬ ë¦¬ìŠ¤íŠ¸ -->
	        <div class="section">
			   <h4>&ensp;ê²Œì‹œê¸€ ë¶ë§ˆí¬ ë¦¬ìŠ¤íŠ¸</h4>
			   <ul>
			       <li th:each="bookmark, iterStat : ${bookmarks}">
			           <!-- ë²ˆí˜¸ -->
			           <span th:text="${(currentBookmarkPage - 1) * 5 + iterStat.index + 1} + '.'"></span>
			           <!-- ì œëª© -->
			           <a th:href="@{/foodhub/post/postDetail(postId=${bookmark.postId})}" 
			              th:text="${#strings.length(bookmark.title) > 15 ? #strings.substring(bookmark.title, 0, 15) + '...' : bookmark.title}">
			           </a>
			           <!-- ë¶ë§ˆí¬ í•´ì œ ë²„íŠ¼ -->
			           <button class="remove-bookmark" th:data-post-id="${bookmark.postId}">ë¶ë§ˆí¬ í•´ì œ</button>
			       </li>
			   </ul>
			
				<!-- í˜ì´ì§• ë²„íŠ¼ -->
				<div class="pagination">
					<!-- ì²« í˜ì´ì§€ ë²„íŠ¼ -->
					<button th:if="${currentBookmarkPage > 1}"
					        th:onclick="'location.href=\'/foodhub/user/myPage?bookmarkPage=1&postPage=' + @{${currentPostPage}} + '&commentPage=' + @{${currentCommentPage}} + '\''">
					    ì²« í˜ì´ì§€
					</button>
					
					<!-- ì´ì „ ë²„íŠ¼ -->
					<button th:if="${currentBookmarkPage > 1}"
					        th:onclick="'location.href=\'/foodhub/user/myPage?bookmarkPage=' + @{${currentBookmarkPage - 1}} + '&postPage=' + @{${currentPostPage}} + '&commentPage=' + @{${currentCommentPage}} + '\''">
					    ì´ì „
					</button>
					
					<!-- í˜„ì¬ í˜ì´ì§€ í‘œì‹œ -->
					<span th:text="|${currentBookmarkPage} / ${totalBookmarkPages}|" style="font-size: 16px; font-weight: bold;"></span>
					
					<!-- ë‹¤ìŒ ë²„íŠ¼ -->
					<button th:if="${currentBookmarkPage < totalBookmarkPages}"
					        th:onclick="'location.href=\'/foodhub/user/myPage?bookmarkPage=' + @{${currentBookmarkPage + 1}} + '&postPage=' + @{${currentPostPage}} + '&commentPage=' + @{${currentCommentPage}} + '\''">
					    ë‹¤ìŒ
					</button>
					
					<!-- ë§ˆì§€ë§‰ í˜ì´ì§€ ë²„íŠ¼ -->
				    <button th:if="${currentBookmarkPage < totalBookmarkPages}"
				            th:onclick="'location.href=\'/foodhub/user/myPage?bookmarkPage=' + @{${totalBookmarkPages}} + '&postPage=' + @{${currentPostPage}} + '&commentPage=' + @{${currentCommentPage}} + '\''">
				        ë§ˆì§€ë§‰ í˜ì´ì§€
				    </button>
				</div>
				
			</div>
	
	        <!-- ë‚˜ì˜ ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ -->
	       <div class="section">
			    <h4>&ensp;ë‚˜ì˜ ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸</h4>
			    <ul>
			        <li th:each="post, postList : ${myPostList}">
			            <div style="display: flex; align-items: center;">
			                <span th:text="${(currentPostPage - 1) * 5 + postList.count} + '.'" style="margin-right: 8px;"></span>
			                <a th:href="@{/foodhub/post/postDetail(postId=${post.postId})}" 
			               		th:text="${#strings.length(post.title) > 20 ? #strings.substring(post.title, 0, 20) + '...' : post.title}">
		               		</a>
			            </div>
			        </li>
			    </ul>
			
			    <!-- í˜ì´ì§• ë²„íŠ¼ -->
			    <div class="pagination">
				    <button th:if="${currentPostPage > 1}"
				            th:onclick="'location.href=\'/foodhub/user/myPage?postPage=' + @{${currentPostPage - 1}} + '\''">
				        ì´ì „
				    </button>
				
				    <span th:text="|${currentPostPage} / ${totalPostPages}|" style="font-size: 16px; font-weight: bold;"></span>
				
				    <button th:if="${currentPostPage < totalPostPages}"
				            th:onclick="'location.href=\'/foodhub/user/myPage?postPage=' + @{${currentPostPage + 1}} + '\''">
				        ë‹¤ìŒ
				    </button>
				</div>
			</div>
				       
	 		<!-- ë‚˜ì˜ ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
	        <div class="section">
	            <h4>&ensp; ë‚˜ì˜ ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸</h4>
	            <ul>
			        <li th:each="comment, commetList : ${myCommentList}">
			            <div style="display: flex; align-items: center;">
			                <span th:text="${(currentCommentPage - 1) * 5 + commetList.count} + '.'" style="margin-right: 8px;"></span>
			                <a th:href="@{/foodhub/post/postDetail(postId=${comment.postId})}"
			                   th:text="${#strings.length(comment.content) > 20 ? #strings.substring(comment.content, 0, 20) + '...' : comment.content}">
			                </a>
			            </div>
			        </li>
			    </ul>
			    <!-- í˜ì´ì§• ë²„íŠ¼ -->
			    <div class="pagination">
				    <button th:if="${currentCommentPage > 1}"
				            th:onclick="'location.href=\'/foodhub/user/myPage?commentPage=' + @{${currentCommentPage - 1}} + '\''">
				        ì´ì „
				    </button>
				
				    <span th:text="|${currentCommentPage} / ${totalCommentPages}|" style="font-size: 16px; font-weight: bold;"></span>
				
				    <button th:if="${currentCommentPage < totalCommentPages}"
				            th:onclick="'location.href=\'/foodhub/user/myPage?commentPage=' + @{${currentCommentPage + 1}} + '\''">
				        ë‹¤ìŒ
				    </button>
				</div>
	        </div>
	
	        <div class="actions">
	            <!-- í”„ë¡œí•„ ìˆ˜ì • ë²„íŠ¼ì„ ë§í¬ë¡œ ë³€ê²½ -->
	            <a th:href="@{/foodhub/user/modifyPage}">
	                <button>í”„ë¡œí•„ ìˆ˜ì •</button>
	            </a>
	
	            <!-- ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ë²„íŠ¼ì„ ë§í¬ë¡œ ì¶”ê°€ -->
	            <a th:href="@{/foodhub/user/changePassword}">
	                <button>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
	            </a>
	            
	            <!-- íšŒì› íƒˆí‡´ ë²„íŠ¼ì„ ë§í¬ë¡œ ë³€ê²½ -->
	            <a th:href="@{/foodhub/user/deleteUser}">
	                <button>íšŒì› íƒˆí‡´</button>
	            </a>
	        </div>

		</div>
		
		<!-- ê´€ë¦¬ì ì „ìš© ì˜ì—­ -->
		<div class="section admin-only-section" th:if="${userDTO.membershipType == 'ADMIN'}">
		  <h4>ğŸ‘‘ ê´€ë¦¬ì ì „ìš© ğŸ‘‘</h4>
		  <div class="admin-box">
		    <p style="margin: 10px 0;">ê´€ë¦¬ì ê¸°ëŠ¥ì€ ë³„ë„ í˜ì´ì§€ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</p>
		    <a href="http://localhost:5173/admin/login" target="_blank" class="admin-link">
		      <button>ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì´ë™</button>
		    </a>
		  </div>
		</div>

        
    </div>

</div>
</body>
</html>
