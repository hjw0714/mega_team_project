<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{foodhub/index/headerAndFooter.html}">

<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<title>ë² ìŠ¤íŠ¸ ê²Œì‹œíŒ</title>

<!-- css ì—°ê²° -->
<link href="/assets/css/bestPostList.css" rel="stylesheet">

<script>
document.addEventListener("DOMContentLoaded", function () {
    function searchPosts() {
        let searchType = document.getElementById("searchType").value;
        let keyword = document.getElementById("searchKeyword").value.trim();
        let categoryId = document.getElementById("categoryId") ? document.getElementById("categoryId").value : null;
        let subCateId = document.getElementById("subCateId") ? document.getElementById("subCateId").value : null;
        let orderType = new URLSearchParams(window.location.search).get("orderType") || "newest"; // orderType ìœ ì§€

        if (keyword === "") {
            alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            return;
        }

        let url = `/foodhub/post/posts?page=1&searchType=${searchType}&keyword=${encodeURIComponent(keyword)}`;

        if (categoryId) {
            url += `&categoryId=${categoryId}`;
        }

        if (subCateId) {
            url += `&subCateId=${subCateId}`;
        }

        if (orderType) {
            url += `&orderType=${orderType}`;
        }

        window.location.href = url;
    }

    // âœ… ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
    document.getElementById("searchBtn").addEventListener("click", searchPosts);
    
    // âœ… ì—”í„°í‚¤ ì…ë ¥ ì‹œ ê²€ìƒ‰ ì‹¤í–‰
    document.getElementById("searchKeyword").addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
            searchPosts();
        }
    });

    // âœ… í˜ì´ì§€ ë¡œë“œ ì‹œ ê²€ìƒ‰ì–´ ìœ ì§€
    const urlParams = new URLSearchParams(window.location.search);
    const searchType = urlParams.get("searchType");
    const keyword = urlParams.get("keyword");

    if (searchType) document.getElementById("searchType").value = searchType;
    if (keyword) document.getElementById("searchKeyword").value = keyword;
});
</script>
</head>
<body class="board-page">
    <div layout:fragment="content">
        <main class="main">
            <section id="board" class="board section">
                <div class="container">
                    <div class="board-header mb-4">
                        <h2 class="mb-3">ë² ìŠ¤íŠ¸ ê²Œì‹œíŒ</h2>
                        <p>ì¶”ì²œì´ ë§ì€ ì¸ê¸° ê²Œì‹œê¸€ì„ í™•ì¸í•´ë³´ì„¸ìš”!</p>
                        <a th:href="@{/foodhub/post/createPost}" class="btn btn-custom mb-4">ìƒˆ ê¸€ ì‘ì„±</a>
                    </div>

                    <div class="board-list">
	                    <div class="list-group" th:if="${postListMap.size() > 0}" th:each="post : ${postListMap}">
	                        <a th:href="@{/foodhub/post/postDetail(postId=${post.postId})}"
	                           class="list-group-item list-group-item-action post-card">
	                            <h5><span class="mb-1 post-title"
		                            th:text="${#strings.length(#strings.concat('[', post['subCateNm'], '] ', post['title'])) > 100} 
		                                     ? ${#strings.concat('[', post['subCateNm'], '] ', #strings.substring(post['title'], 0, 100 - #strings.length(post['subCateNm']) - 3), '...')} 
		                                     : ${#strings.concat('[', post['subCateNm'], '] ', post['title'])}"
		                            th:title="${#strings.concat('[', post['subCateNm'], '] ', post['title'])}"></span>
		                        </h5>
	                            <small class="text-muted">
	                                <span th:text="'ì‘ì„±ì : ' + ${post['nickname']}"></span>
	                                <span th:text="'| ì‘ì„±ì¼ : ' + ${post['createdAt']}"></span>
	                                <span th:text="'| ì¡°íšŒìˆ˜ : ' + ${post['viewCnt']}"></span>
	                                <span th:text="'| ì¶”ì²œìˆ˜ : ' + ${post['LIKE_COUNT']}"></span>
	                            </small>
	                        </a>
	                    </div>
	                    <div class="no-posts" th:if="${postListMap.size() == 0}" align="center">ì¶”ì²œì´ ë§ì€ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>
	                </div>

                   <div class="pagination" th:if="${maxPages > 1}">
				    <!-- ì²˜ìŒ í˜ì´ì§€ë¡œ ì´ë™ -->
				    <a th:href="@{/foodhub/post/posts(page=1, orderType=${orderType}, categoryId=${categoryId}, subCateId=${subCateId}, searchType=${searchType}, keyword=${keyword})}"
				       th:if="${page > 1}">&laquo; ì²« í˜ì´ì§€</a>
				
				    <!-- ì´ì „ í˜ì´ì§€ ê·¸ë£¹ìœ¼ë¡œ ì´ë™ -->
				    <a th:href="@{/foodhub/post/posts(page=${startPage - 1}, orderType=${orderType}, categoryId=${categoryId}, subCateId=${subCateId}, searchType=${searchType}, keyword=${keyword})}"
				       th:if="${startPage > 1}">&lt;</a>
				
				    <!-- í˜„ì¬ í˜ì´ì§€ ê·¸ë£¹ ë‚´ í˜ì´ì§€ë“¤ í‘œì‹œ (5ê°œ ë‹¨ìœ„) -->
				    <th:block th:each="i : ${#numbers.sequence(startPage, endPage)}">
				        <a th:href="@{/foodhub/post/posts(page=${i}, orderType=${orderType}, categoryId=${categoryId}, subCateId=${subCateId}, searchType=${searchType}, keyword=${keyword})}"
				           th:text="${i}" th:classappend="${i == page} ? 'active' : ''"></a>
				    </th:block>
				
				    <!-- ë‹¤ìŒ í˜ì´ì§€ ê·¸ë£¹ìœ¼ë¡œ ì´ë™ -->
				    <a th:href="@{/foodhub/post/posts(page=${endPage + 1}, orderType=${orderType}, categoryId=${categoryId}, subCateId=${subCateId}, searchType=${searchType}, keyword=${keyword})}"
				       th:if="${endPage < maxPages}">&gt;</a>
				
				    <!-- ë§ˆì§€ë§‰ í˜ì´ì§€ë¡œ ì´ë™ -->
				    <a th:href="@{/foodhub/post/posts(page=${maxPages}, orderType=${orderType}, categoryId=${categoryId}, subCateId=${subCateId}, searchType=${searchType}, keyword=${keyword})}"
				       th:if="${page < maxPages}">ë§ˆì§€ë§‰ í˜ì´ì§€ &raquo;</a>
				</div>



                    <!-- ê²€ìƒ‰ì°½ ì¶”ê°€ -->
                    <div class="search-container">
				    <div class="search-box">
				        <select id="searchType">
				            <option value="title">ì œëª©</option>
				            <option value="title_content">ì œëª©+ë‚´ìš©</option>
				        </select>
				        <input type="text" id="searchKeyword" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥">
				        <button type="button" id="searchBtn">ğŸ”</button>
				    </div>
				</div>
              </div>
           </section>
        </main>
    </div>
</body>
</html>
